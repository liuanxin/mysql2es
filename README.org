
[[README-cn.org][中文说明]]

** MariaDB/MySQL to es

   Synchronize the MariaDB/MySQL table data to Elasticsearch, only supports adding and updating,
   does not support physical deletion (physical deletion needs to be processed according to binlog),
   it is recommended to use logical deletion.

   Based on jdk 8 and spring boot 2.0, support es 6.4.2 (2018/11)


The relevant configuration instructions are as follows:
#+BEGIN_SRC yaml
# for db...

config:
  ip-port: ["127.0.0.1:9200"]     # the default is 127.0.0.1:9200
  cron: 0/5 * * * * *             # the default is to execute once per minute

  relation:
    -
      table: t_product            # *** Must be set and have a primary key. The primary key will generate the id of /index/type/id in es
      increment-column: ["id"]    # *** Must be set. Indicates that it is used for data increment operations, using increment `id` or `update_time`

      # Starting with es 6.0, type defaults to _doc, and the index in es directly corresponds to the database table name.
      index: some                 # Indicates the index of /index/type/id in es, not set will be generated from the database table name (t_some_one ==> some-one), greate version 6.0, index name must be lowercase
      scheme: false               # Whether to generate the scheme of es based on the database table structure in advance, the default is true, It is recommended to go to es to build the scheme and set this to false. The scheme generated based on the table structure will set the text and keyword types for the varchar type.
      sql: select * from t_some   # Custom sql statement, no setting will automatically assemble from the database table
      limit: 10                   # The number of times to get from the database, the default is 50
      mapping:                    # 「table column」:「es field」, no setting will be generated from the table field (c_some_type ==> someType), only special cases can be set
        x_type: type
#+END_SRC

about cron
#+BEGIN_EXAMPLE
.------------------- second (0 - 59)   if (0/10) then (0, 10, 20, 30, 40, 50) run
.  .---------------- minute (0 - 59)
.  .  .------------- hour (0 - 23)
.  .  .  .---------- day of month (1 - 31)
.  .  .  .  .------- month (1 - 12)   OR jan,feb,mar,apr,may,jun,jul,aug,sep,oct,nov,dec
.  .  .  .  .  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
.  .  .  .  .  .
?  *  *  *  *  *

for example:  0/5 * * * * *  means that it runs every 5 seconds
#+END_EXAMPLE


** Run
#+BEGIN_SRC conf
git clone https://github.com/liuanxin/mysql2es.git

change application-prod.yml to your setting
mvn clean package -DskipTests
nohup java -jar -Dspring.profiles.active=prod target/mysql2es.jar >/dev/null 2>&1 &

or

mvn clean package -DskipTests
add your ~/application.yml
nohup java -jar -Dspring.config.location=~/application.yml target/mysql2es.jar >/dev/null 2>&1 &


log in ~/logs/mysql2es.log
#+END_SRC


** Comment
Project will query the database based on the configuration at startup, and save the relevant table structure to es.\\
The timer then reads the last processed value from the temporary file based on the set task period (incremental value, first empty),
then starts the database query and synchronizes to es and writes the last value to the temporary file.

